---
---
<div id="formContainer" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md opacity-0 transform translate-y-8">
    <h2 class="text-2xl font-bold text-center mb-6">Cambiar Contraseña</h2>

    <input
      type="password"
      id="password"
      placeholder="Nueva contraseña"
      class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
    <input
      type="password"
      id="confirmPassword"
      placeholder="Confirmar contraseña"
      class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
    />

    <button
      id="submitBtn"
      class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors"
    >
      Guardar
    </button>

    <div id="message" class="mt-4 text-center font-semibold"></div>
  </div>

  <script>
    import gsap from "gsap";
    import { ruta } from "./Welcome.astro";

    // Animación de entrada del formulario
    gsap.to("#formContainer", {
      duration: 0.8,
      opacity: 1,
      y: 0,
      ease: "power2.out",
    });

    const token = new URLSearchParams(window.location.search).get("id_token");
    const btn = document.getElementById("submitBtn");
    const msg = document.getElementById("message");
console.log(token);

    btn.addEventListener("click", async () => {
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      // Validar campos
      if (!password || !confirmPassword) {
        msg.textContent = "Todos los campos son obligatorios";
        msg.className = "mt-4 text-center font-semibold text-red-500";
        return;
      }
      if (password !== confirmPassword) {
        msg.textContent = "Las contraseñas no coinciden";
        msg.className = "mt-4 text-center font-semibold text-red-500";
        return;
      }

      try {
        const res = await fetch(`${ruta}/cambiar-password?id_token=${token}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token: token, password: password }),
        });

        const data = await res.json();
        msg.textContent = data.message;
        msg.className = `mt-4 text-center font-semibold $   {
          data.success ? "text-green-500" : "text-red-500"
        }`;
        // Redirigir al inicio
        setTimeout(() => {
          alert(data.message);
          location.href = "/";
        }, 1500);


        // Animación de éxito
        if (data.success) {
          gsap.to("#formContainer", { scale: 1.05, duration: 0.2, yoyo: true, repeat: 1 });
        }
      } catch (error) {
        msg.textContent = "Error de conexión con el servidor";
        msg.className = "mt-4 text-center font-semibold text-red-500";
      }
    });
  </script>